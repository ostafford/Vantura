{"version":3,"file":"MerchantAnalysisChart-Dk8xMjK_.js","sources":["../../app/javascript/api/resources/analysis.ts","../../app/javascript/hooks/useAnalysisData.ts","../../app/javascript/components/charts/MerchantAnalysisChart.tsx"],"sourcesContent":["/**\n * Typed API functions for analysis resource\n */\n\nimport { apiGet } from '../client'\nimport { endpoints } from '../endpoints'\nimport type { Transaction, Filter } from '../../types/models'\nimport type { ApiResponse } from '../../types/api'\n\nexport interface AnalysisDataParams {\n  filter_id?: number\n}\n\nexport interface AnalysisDataResponse {\n  current_date: string\n  selected_filter: Filter | null\n  transactions: Transaction[]\n  stats: {\n    current_month_income: number\n    current_month_expenses: number\n    net_savings: number\n    last_month_income: number\n    last_month_expenses: number\n    income_change_pct: number\n    expense_change_pct: number\n    net_change_pct: number\n    top_merchant: {\n      name: string\n      amount: number\n    }\n  }\n  breakdowns: Record<string, Record<string, number>>\n}\n\n/**\n * Get analysis data\n * @param params - Query parameters (filter_id)\n */\nexport async function getAnalysisData(\n  params?: AnalysisDataParams\n): Promise<ApiResponse<AnalysisDataResponse>> {\n  return apiGet<AnalysisDataResponse>(endpoints.analysis.data(), params as Record<string, string | number | boolean | null | undefined>)\n}\n\n","/**\n * React Query hook for analysis data\n */\n\nimport { useApiQuery } from './useApi'\nimport { getAnalysisData } from '../api/resources/analysis'\nimport type { AnalysisDataResponse } from '../api/resources/analysis'\n\n/**\n * Fetch analysis data with React Query\n * @param filterId - Optional filter ID to apply\n */\nexport function useAnalysisData(filterId?: number) {\n  return useApiQuery<AnalysisDataResponse>(\n    ['analysis', 'data', filterId],\n    () => getAnalysisData(filterId ? { filter_id: filterId } : undefined),\n    {\n      staleTime: 1000 * 60 * 5 // 5 minutes\n    }\n  )\n}\n\n","/**\n * Merchant analysis chart component\n * Shows breakdown by merchant using ApexCharts\n */\n\nimport React from 'react'\nimport Chart from 'react-apexcharts'\nimport { QueryProvider } from '../../providers/QueryProvider'\nimport { ErrorBoundary } from '../shared/ErrorBoundary'\nimport { useAnalysisData } from '../../hooks/useAnalysisData'\n\ninterface MerchantAnalysisChartProps {\n  filterId?: number\n  height?: number\n  chartType?: 'pie' | 'bar'\n}\n\nfunction MerchantAnalysisChartContent({\n  filterId,\n  height = 400,\n  chartType = 'pie'\n}: MerchantAnalysisChartProps): React.JSX.Element {\n  const { data, isLoading, error } = useAnalysisData(filterId)\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"text-gray-500 dark:text-gray-400\">Loading chart data...</div>\n      </div>\n    )\n  }\n\n  if (error) {\n    return (\n      <div className=\"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg\">\n        <div className=\"text-sm text-red-800 dark:text-red-200\">\n          Error loading chart: {error.error?.message || 'Unknown error'}\n        </div>\n      </div>\n    )\n  }\n\n  const analysisData = data?.data\n  if (!analysisData || !analysisData.breakdowns.merchant) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"text-gray-500 dark:text-gray-400\">No merchant data available</div>\n      </div>\n    )\n  }\n\n  const merchantBreakdown = analysisData.breakdowns.merchant\n  const sortedMerchants = Object.entries(merchantBreakdown)\n    .sort(([, a], [, b]) => Math.abs(b as number) - Math.abs(a as number))\n    .slice(0, 8) // Top 8 merchants\n\n  const labels = sortedMerchants.map(([merchant]) => merchant || 'Uncategorized')\n  const series = sortedMerchants.map(([, amount]) => Math.abs(amount as number))\n  const total = series.reduce((sum, val) => sum + val, 0)\n\n  const colors = ['#3B82F6', '#EF4444', '#10B981', '#F59E0B', '#8B5CF6', '#06B6D4', '#84CC16', '#F97316']\n\n  const baseOptions = {\n    chart: {\n      height: height,\n      fontFamily: 'Inter, sans-serif',\n      toolbar: {\n        show: false\n      },\n      animations: {\n        enabled: true,\n        easing: 'easeinout' as const,\n        speed: 300\n      }\n    },\n    colors: colors,\n    labels: labels,\n    dataLabels: {\n      enabled: true,\n      style: {\n        fontSize: '12px',\n        fontWeight: 'bold'\n      }\n    },\n    legend: {\n      show: chartType === 'pie',\n      position: 'bottom' as const,\n      labels: {\n        colors: window.matchMedia('(prefers-color-scheme: dark)').matches\n          ? '#e5e7eb'\n          : '#374151'\n      }\n    },\n    tooltip: {\n      y: {\n        formatter: (val: number) => `$${val.toFixed(2)}`\n      }\n    },\n    theme: {\n      mode: (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') as 'dark' | 'light'\n    }\n  }\n\n  const chartOptions =\n    chartType === 'pie'\n      ? {\n          ...baseOptions,\n          chart: { ...baseOptions.chart, type: 'pie' as const },\n          dataLabels: {\n            ...baseOptions.dataLabels,\n            formatter: (val: number, opts: unknown) => {\n              const labelIndex = (opts as { seriesIndex?: number }).seriesIndex ?? 0\n              const label = labels[labelIndex] || ''\n              return `${label}: ${val.toFixed(1)}%`\n            }\n          }\n        }\n      : {\n          ...baseOptions,\n          chart: { ...baseOptions.chart, type: 'bar' as const },\n          plotOptions: {\n            bar: {\n              horizontal: false,\n              columnWidth: '55%',\n              endingShape: 'rounded' as const\n            }\n          },\n          xaxis: {\n            categories: labels,\n            labels: {\n              style: {\n                colors: window.matchMedia('(prefers-color-scheme: dark)').matches\n                  ? '#e5e7eb'\n                  : '#374151'\n              }\n            }\n          },\n          yaxis: {\n            title: {\n              text: 'Amount ($)',\n              style: {\n                color: window.matchMedia('(prefers-color-scheme: dark)').matches\n                  ? '#e5e7eb'\n                  : '#374151'\n              }\n            },\n            labels: {\n              formatter: (val: number) => `$${val.toFixed(0)}`,\n              style: {\n                colors: window.matchMedia('(prefers-color-scheme: dark)').matches\n                  ? '#e5e7eb'\n                  : '#374151'\n              }\n            }\n          }\n        }\n\n  return (\n    <div className=\"w-full\">\n      <div className=\"text-center mb-4\">\n        <div className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n          ${total.toFixed(0)}\n        </div>\n        <div className=\"text-sm text-gray-500 dark:text-gray-400\">Total by Merchant</div>\n      </div>\n      <Chart\n        options={chartOptions}\n        series={chartType === 'pie' ? series : [{ name: 'Merchant', data: series }]}\n        type={chartType}\n        height={height}\n      />\n    </div>\n  )\n}\n\n/**\n * MerchantAnalysisChart - Wrapped with QueryProvider and ErrorBoundary\n */\nexport default function MerchantAnalysisChart(props: MerchantAnalysisChartProps): React.JSX.Element {\n  return (\n    <ErrorBoundary>\n      <QueryProvider>\n        <MerchantAnalysisChartContent {...props} />\n      </QueryProvider>\n    </ErrorBoundary>\n  )\n}\n\n"],"names":["getAnalysisData","params","apiGet","endpoints","useAnalysisData","filterId","useApiQuery","MerchantAnalysisChartContent","height","chartType","data","isLoading","error","jsx","jsxs","_a","analysisData","merchantBreakdown","sortedMerchants","b","labels","merchant","series","amount","total","sum","val","baseOptions","chartOptions","opts","labelIndex","Chart","MerchantAnalysisChart","props","ErrorBoundary","QueryProvider"],"mappings":"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"}