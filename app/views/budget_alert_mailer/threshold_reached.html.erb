<!DOCTYPE html>
<html>
  <head>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type' />
  </head>
  <body>
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
      <h1 style="color: #dc2626;">Budget Alert</h1>
      
      <p>Hello <%= @user.email %>,</p>
      
      <p>Your budget <strong><%= @budget.name %></strong> has reached its alert threshold.</p>
      
      <div style="background-color: #f3f4f6; padding: 20px; border-radius: 8px; margin: 20px 0;">
        <h2 style="margin-top: 0;">Budget Details</h2>
        <table style="width: 100%;">
          <% if @budget.category %>
            <tr>
              <td style="padding: 8px 0; font-weight: bold;">Category:</td>
              <td style="padding: 8px 0;"><%= @budget.category.name %></td>
            </tr>
          <% end %>
          <tr>
            <td style="padding: 8px 0; font-weight: bold;">Period:</td>
            <td style="padding: 8px 0;"><%= @budget.period.humanize %></td>
          </tr>
          <tr>
            <td style="padding: 8px 0; font-weight: bold;">Budget Limit:</td>
            <td style="padding: 8px 0;">$<%= number_with_precision(@calculation[:limit], precision: 2) %></td>
          </tr>
          <tr>
            <td style="padding: 8px 0; font-weight: bold;">Amount Spent:</td>
            <td style="padding: 8px 0; color: #dc2626; font-weight: bold;">$<%= number_with_precision(@calculation[:spent], precision: 2) %></td>
          </tr>
          <tr>
            <td style="padding: 8px 0; font-weight: bold;">Remaining:</td>
            <td style="padding: 8px 0;">$<%= number_with_precision(@calculation[:remaining], precision: 2) %></td>
          </tr>
          <tr>
            <td style="padding: 8px 0; font-weight: bold;">Percentage:</td>
            <td style="padding: 8px 0; color: #dc2626; font-weight: bold;"><%= @calculation[:percentage].round(1) %>%</td>
          </tr>
          <tr>
            <td style="padding: 8px 0; font-weight: bold;">Alert Threshold:</td>
            <td style="padding: 8px 0;"><%= @budget.alert_threshold %>%</td>
          </tr>
          <tr>
            <td style="padding: 8px 0; font-weight: bold;">Period:</td>
            <td style="padding: 8px 0;">
              <%= @calculation[:period_start].strftime("%B %d, %Y") %> - 
              <%= @calculation[:period_end].strftime("%B %d, %Y") %>
            </td>
          </tr>
        </table>
      </div>
      
      <div style="margin-top: 30px;">
        <%= link_to "View Budget", budget_url(@budget), style: "background-color: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; display: inline-block;" %>
      </div>
      
      <p style="margin-top: 30px; color: #6b7280; font-size: 14px;">
        This alert was triggered because your spending reached <%= @budget.alert_threshold %>% of your budget limit.
      </p>
    </div>
  </body>
</html>

