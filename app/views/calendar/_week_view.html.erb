<!-- Week View Grid - Matching Month View Layout -->
<div class="bg-gradient-to-br from-neutral-100 to-white dark:from-gray-800 dark:to-gray-900 rounded-2xl shadow-lg border-2 border-primary-700/30 dark:border-primary-500/20 chevron-fix p-4">
  <!-- Weekday Header -->
  <div class="grid grid-cols-7 gap-2 mb-2 border-b border-gray-200 dark:border-gray-700 pb-3">
    <div class="px-2 py-2 text-center font-semibold text-gray-700 dark:text-gray-300">Monday</div>
    <div class="px-2 py-2 text-center font-semibold text-gray-700 dark:text-gray-300">Tuesday</div>
    <div class="px-2 py-2 text-center font-semibold text-gray-700 dark:text-gray-300">Wednesday</div>
    <div class="px-2 py-2 text-center font-semibold text-gray-700 dark:text-gray-300">Thursday</div>
    <div class="px-2 py-2 text-center font-semibold text-gray-700 dark:text-gray-300">Friday</div>
    <div class="px-2 py-2 text-center font-semibold text-gray-700 dark:text-gray-300">Saturday</div>
    <div class="px-2 py-2 text-center font-semibold text-gray-700 dark:text-gray-300">Sunday</div>
  </div>

  <!-- Week Days Grid -->
  <div class="mb-4" data-week-index="0">
    <div class="grid grid-cols-7 gap-2 mb-3">
      <% @week_days.each do |day| %>
        <% total = day_total(day[:date]) %>
        <% transactions = day_transactions(day[:date]) %>
        <% day_id = "day-#{day[:date].to_s}" %>
        <% has_trans = transactions.any? %>
        <% is_today = day[:is_today] %>

        <div class="<%= calendar_day_bg_class(total: total, in_current_month: day[:is_current_month], is_today: is_today) %> rounded-lg px-2 py-2 min-h-[100px] border border-gray-200 dark:border-gray-700 <%= has_trans ? 'hover:bg-blue-50 dark:hover:bg-blue-900/20 cursor-pointer' : '' %> transition-all"
             <% if has_trans %>data-day-id="<%= day_id %>" data-action="click->calendar#toggleDay"<% end %>>
          <!-- Day number in top-left corner -->
          <div class="flex items-start justify-between mb-2">
            <% if is_today %>
              <span class="inline-flex items-center justify-center h-6 w-6 rounded-full bg-primary-700 text-xs font-semibold text-white">
                <%= day[:day_number] %>
              </span>
            <% else %>
              <span class="text-sm font-medium text-gray-700 dark:text-gray-400">
                <%= day[:day_number] %>
              </span>
            <% end %>
          </div>
          
          <!-- Transaction total (centered) -->
          <div class="text-center">
            <div class="text-lg font-semibold <%= total < 0 ? 'text-red-600 dark:text-red-400' : 'text-green-600 dark:text-green-400' %>">
              <% if total != 0 %>
                <%= total < 0 ? "-" : "+" %>$<%= number_with_precision(total.abs, precision: 2) %>
              <% else %>
                $0.00
              <% end %>
            </div>
            <% if transactions.any? %>
              <div class="text-xs text-gray-400 dark:text-gray-500 mt-1">
                <%= transactions.count %> <%= transactions.count == 1 ? 'item' : 'items' %>
              </div>
              <div class="text-xs text-blue-500 dark:text-blue-400 mt-1">Click for details</div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Inline details slot for this week (desktop) -->
    <div id="week-details-0" class="mt-3"></div>

    <!-- Week Summary Row -->
    <% week_start = @date.beginning_of_week(:monday) %>
    <% week_end = @date.end_of_week(:monday) %>
    <%= render partial: 'shared/bento_cards/week_summary_row', 
        locals: { 
          week_index: 0, 
          eow_amount: @week_end_balance, 
          week_start_date: week_start, 
          week_end_date: week_end,
          income_total: @week_income,
          expense_total: @week_expenses,
          net_total: @week_total,
          transaction_count: @week_transaction_count
        } %>
  </div>
</div>

<!-- Transaction Details Sections -->
<% @week_days.each do |day| %>
  <% transactions = day_transactions(day[:date]) %>
  <% if transactions.any? %>
    <% day_id = "day-#{day[:date].to_s}" %>
    <div id="<%= day_id %>" class="hidden mt-6 bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
      <div class="bg-blue-50 dark:bg-blue-900/20 px-6 py-4 border-b border-gray-200 dark:border-gray-700">
        <div class="flex items-center justify-between">
          <h3 class="text-xl font-bold text-gray-900 dark:text-white">
            <%= day[:date].strftime("%A, %B %d, %Y") %>
          </h3>
          <button type="button" data-day-id="<%= day_id %>" data-action="click->calendar#toggleDay" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:scale-110 transition-all">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
      </div>
      <div class="overflow-x-auto">
        <%= render partial: 'shared/transactions/table', locals: { transactions: transactions, compact: false, show_date: false, show_footer_total: true, total_value: day_total(day[:date]) } %>
      </div>
    </div>
  <% end %>
<% end %>
