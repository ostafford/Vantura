<!-- Hero Card (2x2) -->
<%= render 'shared/bento_cards/hero_card',
    title: "Calendar Overview",
    subtitle: "#{@date.strftime('%B %Y')}",
    description: "Visualize your transactions and cash flow with interactive calendar views. Switch between week and month views to see your financial activity spread across time. Track hypothetical transactions, recurring patterns, and actual activity all in one place.",
    icon: 'calendar',
    size: 'bento-span-2 bento-row-span-2',
    color: 'blue' do %>
  <div class="flex flex-col gap-4">
    <!-- Line 1: Current Balance -->
    <div class="flex items-center justify-between">
      <span class="text-blue-50 text-base font-medium">Current Balance:</span>
      <span class="text-3xl font-bold <%= @account.current_balance >= 0 ? 'text-green-400 dark:text-green-300' : 'text-red-400 dark:text-red-300' %>">
        <%= number_to_currency(@account.current_balance) %>
      </span>
    </div>
    
    <!-- Line 2: End of Period -->
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-2">
        <span class="text-blue-50 text-base font-medium"><%= @view == 'week' ? 'End of Week' : 'End of Month' %>:</span>
        <% 
          if @view == 'week'
            # Calculate end of week balance
            week_end = @date.end_of_week(:monday)
            week_transactions = @account.transactions.where(transaction_date: Date.today..week_end)
            end_value = @account.current_balance + week_transactions.sum(:amount)
            end_date = week_end
          else
            end_value = @end_of_month_balance
            end_date = @date.end_of_month
          end
        %>
        <span class="text-blue-100 text-xs">
          (<%= end_date.strftime('%b %d') %>)
        </span>
      </div>
      <span class="text-3xl font-bold <%= end_value >= 0 ? 'text-green-400 dark:text-green-300' : 'text-red-400 dark:text-red-300' %>">
        <%= number_to_currency(end_value) %>
      </span>
    </div>
  </div>
<% end %>

<% if @view == 'week' %>
  <!-- Week View: 4 Vertical Stat Cards -->
  
  <!-- 1. Week Expenses - Using Dashboard Partial -->
  <% week_start = @date.beginning_of_week(:monday) %>
  <% week_end = @date.end_of_week(:monday) %>
  <%= render partial: 'dashboard/transaction_type_card',
      locals: {
        type: 'expense',
        expense_total: @week_expenses,
        expense_count: @week_expense_count,
        current_date: @date,
        top_expense_merchants: @week_top_expense_merchants,
        period: 'week'
      } %>

  <!-- 2. Week Income - Using Dashboard Partial -->
  <%= render partial: 'dashboard/transaction_type_card',
      locals: {
        type: 'income',
        income_total: @week_income,
        income_count: @week_income_count,
        current_date: @date,
        top_income_merchants: @week_top_income_merchants,
        period: 'week'
      } %>

  <!-- 3. Week Range -->
  <% week_start = @date.beginning_of_week(:monday) %>
  <% week_end = @date.end_of_week(:monday) %>
  <%= render 'shared/bento_cards/stat_card',
      title: "Week Range",
      value: "#{week_start.strftime('%b %d')} - #{week_end.strftime('%b %d')}".html_safe,
      subtitle: "<span class='font-semibold text-gray-900 dark:text-white'>#{@week_transaction_count} transactions</span>".html_safe,
      detail: "#{@date.year}",
      icon: 'calendar',
      color: 'blue',
      size: 'bento-span-2 bento-row-span-1' %>
  
  <!-- 4. Week Hypothetical -->
  <% hypothetical_total = @hypothetical_income - @hypothetical_expenses %>
  <%= render 'shared/bento_cards/stat_card',
      title: "Hypothetical",
      value: "#{hypothetical_total < 0 ? '-' : ''}#{number_to_currency(hypothetical_total.abs)}",
      subtitle: "<span class='font-semibold text-gray-900 dark:text-white'>Projected</span>".html_safe,
      detail: "#{number_to_currency(@hypothetical_income)} income • #{number_to_currency(@hypothetical_expenses)} expenses",
      icon: 'refresh',
      color: 'blue',
      size: 'bento-span-2 bento-row-span-1' %>
  
<% else %>
  <!-- Month View: 4 Vertical Stat Cards -->
  
  <!-- 1. Month Expenses - Using Dashboard Partial -->
  <%= render partial: 'dashboard/transaction_type_card',
      locals: {
        type: 'expense',
        expense_total: @actual_expenses,
        expense_count: @month_expense_count,
        current_date: @date,
        top_expense_merchants: @month_top_expense_merchants,
        period: 'month'
      } %>

  <!-- 2. Month Income - Using Dashboard Partial -->
  <%= render partial: 'dashboard/transaction_type_card',
      locals: {
        type: 'income',
        income_total: @actual_income,
        income_count: @month_income_count,
        current_date: @date,
        top_income_merchants: @month_top_income_merchants,
        period: 'month'
      } %>

  <!-- 3. Month Progress -->
  <%= render 'shared/bento_cards/stat_card',
      title: "Month Progress",
      value: "#{@progress_pct}%",
      subtitle: "<span class='font-semibold text-gray-900 dark:text-white'>Day #{@month_day} of #{@total_days}</span>".html_safe,
      detail: @date.strftime('%b %d, %Y'),
      icon: 'calendar',
      color: 'blue',
      size: 'bento-span-2 bento-row-span-1' %>
  
  <!-- 4. Month Hypothetical -->
  <% hypothetical_total = @hypothetical_income - @hypothetical_expenses %>
  <%= render 'shared/bento_cards/stat_card',
      title: "Hypothetical",
      value: "#{hypothetical_total < 0 ? '-' : ''}#{number_to_currency(hypothetical_total.abs)}",
      subtitle: "<span class='font-semibold text-gray-900 dark:text-white'>Projected</span>".html_safe,
      detail: "#{number_to_currency(@hypothetical_income)} income • #{number_to_currency(@hypothetical_expenses)} expenses",
      icon: 'refresh',
      color: 'blue',
      size: 'bento-span-2 bento-row-span-1' %>
<% end %>

